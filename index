<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCA College Modasa | Python Exam 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+Gujarati:wght@400;700;900&family=Noto+Sans+Devanagari:wght@400;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        .font-gujarati { font-family: 'Noto Sans Gujarati', sans-serif; }
        .font-hindi { font-family: 'Noto Sans Devanagari', sans-serif; }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        .glass { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.1); }
        
        .text-gradient {
            background: linear-gradient(to r, #10b981, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .animated-gradient { 
            background: linear-gradient(-45deg, #10b981, #3b82f6, #064e3b, #1e3a8a); 
            background-size: 400% 400%; 
            animation: gradient 15s ease infinite; 
        }
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        button, input { min-height: 44px; }

        /* Modal Styles */
        .modal-overlay { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(4px); }
        
        .college-highlight {
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.2), rgba(59, 130, 246, 0.2));
            border: 1px solid rgba(16, 185, 129, 0.4);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.1);
        }
    </style>
</head>
<body class="bg-slate-950 text-white min-h-screen overflow-x-hidden">

    <!-- Custom Message Box (Modal) -->
    <div id="custom-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 modal-overlay">
        <div class="bg-slate-900 border border-slate-800 p-8 rounded-3xl shadow-2xl max-w-sm w-full text-center">
            <div id="modal-icon" class="mb-4 flex justify-center"></div>
            <h3 id="modal-title" class="text-xl font-bold mb-2"></h3>
            <p id="modal-message" class="text-slate-400 text-sm mb-6"></p>
            <button onclick="closeModal()" class="w-full py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-black rounded-xl transition-all uppercase tracking-widest text-xs">Acknowledge</button>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="glass sticky top-0 z-50 px-4 md:px-6 py-3 flex justify-between items-center">
        <div class="flex items-center gap-2 md:gap-3 cursor-pointer" onclick="showView('home')">
            <span id="nav-logo" class="text-2xl md:text-3xl animate-bounce">üêç</span>
            <div>
                <h1 class="text-white font-black text-base md:text-xl leading-tight tracking-tighter uppercase">BCA COLLEGE <span class="text-emerald-400">MODASA</span></h1>
                <p class="text-slate-400 text-[9px] md:text-[10px] font-hindi uppercase tracking-widest font-bold opacity-70">Professor Amit Raval</p>
            </div>
        </div>
        <div class="hidden md:flex gap-4 lg:gap-6 text-slate-300 font-medium text-sm">
            <button onclick="showView('home')" class="hover:text-emerald-400 transition-colors">Home</button>
            <button onclick="validateAndGoToExam()" class="hover:text-emerald-400 transition-colors font-bold">Exam</button>
            <button onclick="showView('result')" class="hover:text-emerald-400 transition-colors">Results</button>
            <button onclick="showView('admin-login')" class="hover:text-emerald-400 transition-colors">Admin</button>
        </div>
        <div class="text-right">
            <p class="hidden sm:block text-[9px] text-slate-500 uppercase tracking-widest font-bold font-gujarati">‡™™‡™æ‡™Ø‡™•‡´ã‡™® ‡™≤‡´á‡™¨</p>
            <p class="text-[10px] md:text-sm font-semibold text-emerald-400">+91 9638143173</p>
        </div>
    </nav>

    <!-- App Views Container -->
    <main id="app-container" class="w-full max-w-7xl mx-auto px-4">
        <!-- Views load here -->
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 py-8 md:py-10 border-t border-slate-800 text-center mt-12 md:mt-20">
        <div class="px-6 text-center">
            <h2 class="text-slate-400 text-xs md:text-sm font-black uppercase tracking-[0.3em] mb-4">BCA College Modasa</h2>
            <p class="text-slate-500 text-xs md:text-sm mb-4 italic font-gujarati">‡™≤‡´ã‡™ú‡™ø‡™ï ‡™•‡´Ä ‡™≤‡™ï‡´ç‡™∑‡´ç‡™Ø ‡™∏‡´Å‡™ß‡´Ä, ‡™°‡™ø‡™ú‡™ø‡™ü‡™≤ ‡™≠‡™æ‡™∞‡™§ ‡™®‡´á ‡™ï‡´ã‡™° ‡™ï‡™∞‡´Ä ‡™∞‡™π‡´ç‡™Ø‡™æ ‡™õ‡´Ä‡™è!</p>
            <p class="text-slate-400 text-[10px] md:text-sm font-bold">¬© 2025 Professor Amit Raval | +91 9638143173</p>
            <div class="mt-6 flex flex-wrap justify-center gap-3 md:gap-4 text-[9px] md:text-[10px] text-slate-600 uppercase tracking-widest font-bold">
                <span class="font-gujarati border border-slate-800 px-2 py-1 rounded-md">Byte by Byte</span>
                <span class="font-hindi border border-slate-800 px-2 py-1 rounded-md">‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§≠‡§æ‡§∞‡§§</span>
                <span class="font-hindi border border-slate-800 px-2 py-1 rounded-md">‡™®‡™µ‡´Ä ‡™∂‡´ã‡™ß</span>
            </div>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, addDoc, query } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'bca-modasa-python-2025';

        window.state = {
            view: 'home',
            user: null,
            student: { name: '', roll: '' },
            exam: { active: false, questions: [], currentIndex: 0, answers: {}, timeLeft: 1500, isSubmitted: false },
            results: [],
            requests: [],
            adminAuth: false,
            examControl: { logo: 'üêç' },
            currentTime: new Date()
        };

        // --- EXAM TIMING UPDATED TO 07:32 AM FOR TESTING ---
        const EXAM_START = new Date('2025-12-27T07:32:00');
        const EXAM_END = new Date('2025-12-27T20:00:00');

        const QUESTION_BANK = [
            { id: 1, q: "Python was created by?", options: ["Guido van Rossum", "Dennis Ritchie", "Bjarne Stroustrup", "James Gosling", "None of above"], correct: 0 },
            { id: 2, q: "Which of these is used for multi-line comments?", options: ["#", "/* */", "''' '''", "//", "None of above"], correct: 2 },
            { id: 3, q: "Which data type is immutable?", options: ["List", "Dictionary", "Set", "Tuple", "None of above"], correct: 3 },
            { id: 4, q: "What is the output of 2**3?", options: ["6", "8", "9", "5", "None of above"], correct: 1 },
            { id: 5, q: "Which loop is not supported in Python?", options: ["for", "while", "do-while", "nested for", "None of above"], correct: 2 },
            { id: 6, q: "History: In which year was Python 0.9.0 released?", options: ["1989", "1991", "1995", "2000", "None of above"], correct: 1 },
            { id: 7, q: "Correct syntax for 'if' statement?", options: ["if x > 5 then:", "if (x > 5)", "if x > 5:", "if x > 5 {}", "None of above"], correct: 2 },
            { id: 8, q: "How to add element at the end of List?", options: ["add()", "insert()", "push()", "append()", "None of above"], correct: 3 },
            { id: 9, q: "Which keyword is used for function definition?", options: ["func", "define", "def", "function", "None of above"], correct: 2 },
            { id: 10, q: "What is used to define a block of code in Python?", options: ["Brackets", "Indentation", "Parentheses", "Quotes", "None of above"], correct: 1 },
            ...Array.from({ length: 15 }, (_, i) => ({
                id: 11 + i,
                q: `Python Programming Q${11+i}: What is the correct syntax to output 'Hello World' in Python?`,
                options: ["echo 'Hello World'", "p('Hello World')", "print('Hello World')", "System.out.println('Hello World')", "None of above"],
                correct: 2
            }))
        ];

        window.showMessage = (title, msg, type = 'info') => {
            const modal = document.getElementById('custom-modal');
            const icon = document.getElementById('modal-icon');
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-message').innerText = msg;
            
            icon.innerHTML = type === 'error' 
                ? '<div class="p-4 bg-red-500/10 rounded-full text-red-500"><i data-lucide="alert-circle" class="w-8 h-8"></i></div>'
                : '<div class="p-4 bg-emerald-500/10 rounded-full text-emerald-500"><i data-lucide="info" class="w-8 h-8"></i></div>';
            
            modal.classList.remove('hidden');
            lucide.createIcons();
        };

        window.closeModal = () => {
            document.getElementById('custom-modal').classList.add('hidden');
        };

        async function init() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) { console.error("Authentication failed:", err); }

            onAuthStateChanged(auth, (u) => {
                window.state.user = u;
                if(u) listenToData();
            });

            setInterval(() => {
                window.state.currentTime = new Date();
                if (window.state.view === 'home') renderHome();
            }, 1000);

            showView('home');
        }

        function listenToData() {
            if (!window.state.user) return;
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'results'), (snap) => {
                window.state.results = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a,b) => b.score - a.score);
                if (window.state.view === 'result') renderResult();
            });
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'requests'), (snap) => {
                window.state.requests = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (window.state.view === 'admin-panel') renderAdminPanel();
            });
        }

        window.validateAndGoToExam = () => {
            const now = window.state.currentTime;
            if (now < EXAM_START) {
                showMessage("Exam Window Closed", "The examination has not started yet. It will be available at 07:32 AM.", 'info');
                showView('home');
            } else if (now > EXAM_END) {
                showMessage("Session Expired", "The examination window has closed. Please contact Professor Amit Raval for details.", 'error');
                showView('home');
            } else {
                showView('student-form');
            }
        };

        window.showView = (v) => {
            window.state.view = v;
            const container = document.getElementById('app-container');
            container.innerHTML = '';
            
            if (v === 'home') renderHome();
            if (v === 'student-form') renderStudentForm();
            if (v === 'exam') renderExam();
            if (v === 'result') renderResult();
            if (v === 'admin-login') renderAdminLogin();
            if (v === 'admin-panel') {
                if(window.state.adminAuth) renderAdminPanel();
                else renderAdminLogin();
            }
            lucide.createIcons();
            window.scrollTo(0,0);
        };

        function renderHome() {
            const isLive = window.state.currentTime >= EXAM_START && window.state.currentTime <= EXAM_END;
            const timeToStart = Math.max(0, EXAM_START - window.state.currentTime);
            
            let html = `
                <div class="min-h-[80vh] flex flex-col items-center justify-center p-4 md:p-6 relative overflow-hidden text-center">
                    <div class="z-10 w-full max-w-4xl px-2">
                        <!-- COLLEGE HIGHLIGHT BADGE -->
                        <div class="inline-flex items-center gap-3 px-6 py-2 rounded-full college-highlight text-emerald-400 text-xs md:text-sm font-black tracking-widest uppercase mb-8 animate-pulse">
                            <i data-lucide="graduation-cap" class="w-4 h-4 md:w-5 md:h-5"></i>
                            BCA COLLEGE MODASA
                        </div>

                        <p class="text-slate-300 text-sm md:text-xl mb-6 md:mb-12 leading-relaxed font-semibold">
                            Professional Python Assessment Portal for BCA Sem 4 <br class="hidden md:block"> 
                            Students of BCA College Modasa.
                        </p>

                        <div class="mb-12">
                            <span class="text-emerald-400 font-bold block text-lg md:text-2xl tracking-wide uppercase leading-tight">
                                Empowering Future Engineers with Python:<br class="hidden md:block">
                                Driving Professional Excellence for a Digital Bharat.
                            </span>
                        </div>
            `;

            if (!isLive && window.state.currentTime < EXAM_START) {
                const h = Math.floor(timeToStart / 3600000);
                const m = Math.floor((timeToStart % 3600000) / 60000);
                const s = Math.floor((timeToStart % 60000) / 1000);
                html += `
                    <div class="bg-slate-900/50 p-6 md:p-8 rounded-2xl md:rounded-3xl border border-slate-800 backdrop-blur-sm shadow-2xl mx-auto max-w-md">
                        <h3 class="text-xl md:text-2xl font-bold mb-4 text-emerald-400 uppercase tracking-widest">Exam Countdown:</h3>
                        <div class="grid grid-cols-3 gap-3 md:gap-6 text-center font-mono text-white">
                            <div class="bg-slate-800 p-3 md:p-6 rounded-xl md:rounded-2xl border border-slate-700 shadow-inner"><span class="text-3xl md:text-5xl font-black block leading-tight">${h}</span><span class="text-[8px] md:text-[10px] text-slate-500 uppercase font-gujarati tracking-[0.2em] mt-1 md:mt-2 block">‡™ï‡™≤‡™æ‡™ï</span></div>
                            <div class="bg-slate-800 p-3 md:p-6 rounded-xl md:rounded-2xl border border-slate-700 shadow-inner"><span class="text-3xl md:text-5xl font-black block leading-tight">${m}</span><span class="text-[8px] md:text-[10px] text-slate-500 uppercase font-gujarati tracking-[0.2em] mt-1 md:mt-2 block">‡™Æ‡™ø‡™®‡™ø‡™ü</span></div>
                            <div class="bg-slate-800 p-3 md:p-6 rounded-xl md:rounded-2xl border border-slate-700 shadow-inner"><span class="text-3xl md:text-5xl font-black block leading-tight">${s}</span><span class="text-[8px] md:text-[10px] text-slate-500 uppercase font-gujarati tracking-[0.2em] mt-1 md:mt-2 block">‡™∏‡´á‡™ï‡™®‡´ç‡™°</span></div>
                        </div>
                    </div>
                `;
            } else if (!isLive && window.state.currentTime > EXAM_END) {
                html += `
                    <div class="bg-red-500/10 p-6 md:p-10 rounded-2xl md:rounded-3xl border border-red-500/30 shadow-xl max-w-lg mx-auto">
                        <h3 class="text-xl md:text-3xl font-black text-red-400 mb-2 uppercase tracking-tighter">EXAMINATION ENDED</h3>
                        <p class="text-slate-500 text-[10px] md:text-sm mb-6 md:mb-8 tracking-wide italic">The scheduled exam window for BCA College Modasa has closed.</p>
                        <button onclick="showView('result')" class="w-full md:w-auto px-10 py-4 bg-white text-black font-black rounded-xl hover:bg-slate-200 transition-all shadow-lg uppercase tracking-widest text-[10px] md:text-xs">Go to Leaderboard</button>
                    </div>
                `;
            } else {
                html += `
                    <div class="flex flex-col sm:flex-row gap-4 md:gap-6 justify-center">
                        <button onclick="validateAndGoToExam()" class="w-full sm:w-auto px-8 md:px-12 py-4 md:py-5 bg-emerald-500 hover:bg-emerald-600 text-white font-black rounded-xl md:rounded-2xl shadow-xl shadow-emerald-500/20 flex items-center justify-center gap-3 transition-all transform hover:scale-105 uppercase tracking-widest text-[10px] md:text-sm">
                            START EXAMINATION <i data-lucide="play-circle" class="w-4 h-4 md:w-5 md:h-5"></i>
                        </button>
                        <button onclick="showView('result')" class="w-full sm:w-auto px-8 md:px-12 py-4 md:py-5 bg-slate-800 hover:bg-slate-700 text-white font-black rounded-xl md:rounded-2xl flex items-center justify-center gap-3 transition-all uppercase tracking-widest text-[10px] md:text-sm border border-slate-700">
                            LIVE LEADERBOARD <i data-lucide="trophy" class="w-4 h-4 md:w-5 md:h-5"></i>
                        </button>
                    </div>
                `;
            }

            html += `</div></div>`;
            document.getElementById('app-container').innerHTML = html;
            lucide.createIcons();
        }

        function renderStudentForm() {
            let html = `
                <div class="min-h-[80vh] flex items-center justify-center p-4 text-center">
                    <div class="bg-slate-900 w-full max-w-md p-6 md:p-10 rounded-[2rem] md:rounded-[3rem] border border-slate-800 shadow-2xl relative">
                        <h2 class="text-slate-500 text-[10px] md:text-xs font-black uppercase tracking-[0.3em] mb-4">BCA COLLEGE MODASA</h2>
                        <h2 class="text-2xl md:text-3xl font-black text-white mb-2 tracking-tight">Student Authentication</h2>
                        <p class="text-slate-500 mb-8 italic text-[11px] md:text-sm font-medium">Verify your identification to proceed.</p>
                        <div class="space-y-4 md:space-y-6 text-left">
                            <input id="std-name" type="text" placeholder="Full Academic Name" class="w-full bg-slate-800 rounded-xl md:rounded-2xl p-4 md:p-5 text-white outline-none focus:ring-2 focus:ring-emerald-500 border border-slate-700 transition-all text-sm md:text-base" value="${window.state.student.name}">
                            <input id="std-roll" type="text" placeholder="Roll No (e.g. 50)" class="w-full bg-slate-800 rounded-xl md:rounded-2xl p-4 md:p-5 text-white outline-none focus:ring-2 focus:ring-emerald-500 border border-slate-700 transition-all text-sm md:text-base" value="${window.state.student.roll}">
                        </div>
                        <div class="mt-8 p-4 md:p-6 bg-emerald-500/5 border border-emerald-500/20 rounded-2xl text-left text-[10px] md:text-[11px] text-slate-400 leading-relaxed font-mono">
                            <h4 class="text-emerald-400 font-black mb-2 flex items-center gap-2 tracking-widest uppercase"><i data-lucide="terminal" class="w-3 h-3"></i> EXAM_PROTOCOL:</h4>
                            <ul class="list-disc ml-4 space-y-1">
                                <li>Assessment: BCA College Modasa Sem 4.</li>
                                <li>Time: 25 Minutes duration.</li>
                                <li>Security: Fullscreen Mandatory.</li>
                            </ul>
                        </div>
                        <button onclick="handleStartExam()" class="w-full mt-8 py-4 md:py-5 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-black rounded-xl md:rounded-2xl shadow-xl transition-all active:scale-95 tracking-widest uppercase text-xs md:text-sm">Verify & Begin</button>
                    </div>
                </div>
            `;
            document.getElementById('app-container').innerHTML = html;
            lucide.createIcons();
        }

        window.handleStartExam = async () => {
            const now = new Date();
            if (now < EXAM_START || now > EXAM_END) {
                showMessage("Protocol Rejected", "Exam window opens at 07:32 AM.", 'error');
                showView('home');
                return;
            }

            const name = document.getElementById('std-name').value;
            const roll = document.getElementById('std-roll').value;
            if (!name || !roll) return showMessage("Fields Missing", "Provide name and roll number.", 'info');
            window.state.student = { name, roll };

            const existing = window.state.results.find(r => r.roll === roll);
            if (existing) {
                const req = window.state.requests.find(r => r.roll === roll);
                if (req && req.status === 'approved') {
                } else if (req && req.status === 'pending') {
                    return showMessage("Authorization Pending", "Your request is under review.", 'info');
                } else {
                    if (confirm("Detected previous attempt. Request re-assessment authorization from Professor Amit Raval?")) {
                        if (window.state.user) {
                            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'requests'), {
                                name, roll, status: 'pending', timestamp: new Date().toISOString()
                            });
                            showMessage("Request Submitted", "Sent to dashboard.", 'info');
                        }
                    }
                    return;
                }
            }

            try {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen().catch(e => console.warn("Fullscreen blocked", e));
                }
            } catch(e) {}

            window.state.exam.questions = [...QUESTION_BANK].sort(() => 0.5 - Math.random()).slice(0, 25);
            window.state.exam.active = true;
            window.state.exam.currentIndex = 0;
            window.state.exam.answers = {};
            window.state.exam.timeLeft = 1500;
            window.state.exam.isSubmitted = false;

            startTimer();
            showView('exam');
        };

        function startTimer() {
            const timer = setInterval(() => {
                if (!window.state.exam.active) { clearInterval(timer); return; }
                window.state.exam.timeLeft--;
                if (window.state.exam.timeLeft <= 0) {
                    clearInterval(timer);
                    handleSubmitExam(true);
                } else {
                    const el = document.getElementById('exam-timer-display');
                    if (el) {
                        const m = Math.floor(window.state.exam.timeLeft / 60);
                        const s = window.state.exam.timeLeft % 60;
                        el.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                        if (window.state.exam.timeLeft < 300) el.classList.add('text-red-500', 'animate-pulse');
                    }
                }
            }, 1000);
        }

        function renderExam() {
            const q = window.state.exam.questions[window.state.exam.currentIndex];
            if (!q) return;

            let html = `
                <div class="min-h-screen p-3 md:p-6 lg:p-10 select-none">
                    <div class="flex flex-wrap justify-between items-center bg-slate-900 p-4 md:p-8 rounded-2xl md:rounded-[2.5rem] border border-slate-800 mb-6 md:mb-10 gap-4 shadow-xl">
                        <div class="flex items-center gap-3 md:gap-5">
                            <div class="w-10 h-10 md:w-14 md:h-14 bg-emerald-500 rounded-lg md:rounded-2xl flex items-center justify-center font-black text-lg md:text-2xl">${window.state.exam.currentIndex + 1}</div>
                            <div>
                                <h3 class="font-bold text-sm md:text-xl truncate max-w-[120px] md:max-w-none text-white">${window.state.student.name}</h3>
                                <p class="text-[8px] md:text-[10px] text-slate-500 uppercase font-black font-mono">BCA_MODASA_ID: ${window.state.student.roll}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 md:gap-10 font-mono">
                            <div class="text-center"><p class="text-[8px] md:text-[10px] text-slate-500 uppercase font-black mb-1">REMAINING TIME</p><span id="exam-timer-display" class="text-xl md:text-3xl font-black text-emerald-400">25:00</span></div>
                            <button onclick="handleSubmitExam(false)" class="px-4 md:px-10 py-2 md:py-4 bg-red-500/10 text-red-500 border border-red-500/20 rounded-xl md:rounded-2xl font-black uppercase text-[10px] md:text-xs tracking-widest hover:bg-red-500 hover:text-white transition-all">Submit</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 md:gap-10">
                        <div class="lg:col-span-3">
                            <div class="bg-slate-900 p-6 md:p-16 rounded-2xl md:rounded-[3.5rem] border border-slate-800 shadow-2xl min-h-[350px] md:min-h-[500px] flex flex-col relative overflow-hidden">
                                <p class="text-slate-500 mb-4 md:mb-6 font-mono text-[9px] md:text-xs font-bold tracking-widest uppercase">BCA_COLLEGE_MODASA_PYTHON_ASSESSMENT</p>
                                <h2 class="text-lg md:text-2xl lg:text-3xl font-bold leading-tight mb-8 md:mb-12 text-white">${q.q}</h2>
                                <div class="grid grid-cols-1 gap-3 md:gap-5 mt-auto">
                                    ${q.options.map((opt, i) => `
                                        <button onclick="selectAnswer(${i})" class="w-full p-4 md:p-6 text-left rounded-xl md:rounded-[1.5rem] border-2 transition-all flex justify-between items-center group ${window.state.exam.answers[window.state.exam.currentIndex] === i ? 'bg-emerald-500 border-emerald-400 text-white' : 'bg-slate-800 border-slate-700 text-slate-300 hover:border-emerald-500/50'}">
                                            <span class="font-bold text-xs md:text-base">${opt}</span>
                                            <div class="w-5 h-5 md:w-7 md:h-7 rounded-full border-2 flex items-center justify-center ${window.state.exam.answers[window.state.exam.currentIndex] === i ? 'border-white' : 'border-slate-600 group-hover:border-slate-400'}">
                                                ${window.state.exam.answers[window.state.exam.currentIndex] === i ? '<div class="w-2 h-2 md:w-3 md:h-3 bg-white rounded-full"></div>' : ''}
                                            </div>
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="flex justify-between mt-6 md:mt-10">
                                <button onclick="changeQ(-1)" class="px-6 md:px-10 py-4 md:py-5 bg-slate-800 text-white rounded-xl md:rounded-2xl flex items-center gap-2 hover:bg-slate-700 transition-all font-black disabled:opacity-30 text-[10px] md:text-xs uppercase tracking-widest" ${window.state.exam.currentIndex === 0 ? 'disabled' : ''}><i data-lucide="chevron-left"></i> Previous</button>
                                <button onclick="changeQ(1)" class="px-6 md:px-10 py-4 md:py-5 bg-slate-800 text-white rounded-xl md:rounded-2xl flex items-center gap-2 hover:bg-slate-700 transition-all font-black disabled:opacity-30 text-[10px] md:text-xs uppercase tracking-widest" ${window.state.exam.currentIndex === 24 ? 'disabled' : ''}>Next <i data-lucide="chevron-right"></i></button>
                            </div>
                        </div>
                        <div class="lg:col-span-1 bg-slate-900 p-6 md:p-8 rounded-2xl md:rounded-[2.5rem] border border-slate-800 shadow-2xl h-fit">
                            <h4 class="font-black mb-4 md:mb-6 text-slate-400 text-[10px] md:text-xs uppercase tracking-widest">Question Matrix</h4>
                            <div class="grid grid-cols-5 gap-2 md:gap-3 text-white">
                                ${window.state.exam.questions.map((_, i) => `
                                    <button onclick="jumpToQ(${i})" class="w-full aspect-square rounded-lg md:rounded-xl text-[9px] md:text-xs font-black border transition-all ${window.state.exam.currentIndex === i ? 'ring-2 ring-emerald-500' : ''} ${window.state.exam.answers[i] !== undefined ? 'bg-emerald-500 text-white border-emerald-400' : 'bg-slate-800 border-slate-700 text-slate-500'}">${i+1}</button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('app-container').innerHTML = html;
            lucide.createIcons();
        }

        window.selectAnswer = (i) => { window.state.exam.answers[window.state.exam.currentIndex] = i; renderExam(); };
        window.changeQ = (dir) => { const next = window.state.exam.currentIndex + dir; if (next >= 0 && next < 25) { window.state.exam.currentIndex = next; renderExam(); } };
        window.jumpToQ = (i) => { window.state.exam.currentIndex = i; renderExam(); };

        window.handleSubmitExam = async (auto) => {
            if (!auto && !confirm("Finalize assessment?")) return;
            window.state.exam.active = false;
            try { if (document.fullscreenElement) document.exitFullscreen(); } catch(e) {}

            let score = 0;
            const details = window.state.exam.questions.map((q, idx) => {
                const ans = window.state.exam.answers[idx];
                if (ans === q.correct) score++;
                return { q: q.q, selected: ans, correct: q.correct, options: q.options };
            });

            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'results', window.state.student.roll), {
                name: window.state.student.name, roll: window.state.student.roll, score, total: 25, details, timestamp: new Date().toISOString()
            });
            showView('result');
        };

        function renderResult() {
            const myResult = window.state.results.find(r => r.roll === window.state.student.roll);
            
            let html = `
                <div class="p-4 md:p-12 text-center">
                    <div class="max-w-7xl mx-auto flex flex-col lg:flex-row gap-6 md:gap-10 text-left">
                        <div class="flex-1">
                            <div class="bg-slate-900/50 p-6 md:p-10 rounded-2xl md:rounded-[3rem] border border-slate-800 shadow-2xl backdrop-blur-md">
                                <h2 class="text-slate-500 text-[10px] md:text-xs font-black uppercase tracking-[0.3em] mb-4">BCA COLLEGE MODASA</h2>
                                <div class="flex flex-wrap justify-between items-end mb-8 md:mb-12 gap-4">
                                    <div><h2 class="text-2xl md:text-4xl font-black text-gradient uppercase italic tracking-tighter">Leaderboard</h2><p class="text-slate-500 font-sans mt-1 uppercase tracking-widest text-[9px] font-bold">Sem 4 Python Performance</p></div>
                                    <i data-lucide="trophy" class="w-10 h-10 md:w-14 md:h-14 text-yellow-500"></i>
                                </div>
                                <div class="space-y-6 md:space-y-8">
                                    ${window.state.results.slice(0, 10).map((res, i) => `
                                        <div class="relative group">
                                            <div class="flex justify-between items-center mb-2 md:mb-3 px-1 md:px-3">
                                                <div class="flex items-center gap-3 md:gap-4 overflow-hidden">
                                                    <span class="shrink-0 w-6 h-6 md:w-8 md:h-8 rounded-lg flex items-center justify-center text-[10px] md:text-xs font-black ${i < 3 ? 'bg-yellow-500 text-black shadow-lg' : 'bg-slate-800 text-slate-400'}">${i+1}</span>
                                                    <span class="font-bold text-slate-200 text-xs md:text-base truncate">${res.name}</span>
                                                </div>
                                                <span class="font-mono text-emerald-400 text-xs md:text-sm font-black">${res.score}/25</span>
                                            </div>
                                            <div class="w-full bg-slate-800 h-1.5 md:h-2.5 rounded-full overflow-hidden border border-slate-700/50">
                                                <div class="h-full bg-gradient-to-r from-emerald-500 to-blue-500 transition-all duration-1000" style="width: ${(res.score/25)*100}%"></div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
            `;

            if (myResult) {
                html += `
                    <div class="w-full lg:w-96 space-y-6 md:space-y-10">
                        <div class="animated-gradient p-8 md:p-10 rounded-[2rem] md:rounded-[3rem] shadow-2xl relative overflow-hidden group text-center">
                            <h2 class="text-white/30 text-[8px] md:text-[10px] font-black uppercase tracking-[0.3em] mb-4 relative z-10">BCA COLLEGE MODASA</h2>
                            <h3 class="text-lg md:text-xl font-black mb-3 font-sans text-white uppercase tracking-widest relative z-10">Student Score</h3>
                            <div class="text-6xl md:text-8xl font-black mb-6 text-white tracking-tighter relative z-10">${myResult.score}<span class="text-xl md:text-2xl text-white/50">/25</span></div>
                            <p class="text-white/80 font-bold font-sans relative z-10 text-base md:text-lg italic uppercase">VALIDATED_SESSION</p>
                            <p class="text-white font-bold relative z-10 mt-2">${myResult.name}</p>
                        </div>
                        <div class="bg-slate-900 p-6 md:p-8 rounded-2xl md:rounded-[2.5rem] border border-slate-800 shadow-xl font-mono">
                            <h4 class="font-black mb-4 md:mb-6 text-[10px] md:text-xs uppercase tracking-widest text-emerald-400 flex items-center gap-2"><i data-lucide="terminal" class="w-4 h-4"></i> Session_Analysis</h4>
                            <div class="max-h-[300px] md:max-h-[350px] overflow-y-auto space-y-3 custom-scrollbar pr-1 text-white">
                                ${myResult.details.map((d, i) => `
                                    <div class="p-3 md:p-4 bg-slate-800/40 rounded-xl border border-slate-700/50 text-[10px] md:text-[11px] font-black uppercase">
                                        <p class="text-slate-500 mb-1 truncate">LOG_Q${i+1}: ${d.q}</p>
                                        <div class="flex justify-between">
                                            <span class="${d.selected === d.correct ? 'text-emerald-400' : 'text-red-400'}">Response: ${d.selected !== undefined ? d.options[d.selected] : 'SKIP'}</span>
                                            <span class="text-slate-500 ml-2">Correct: ${d.options[d.correct]}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            html += `</div></div>`;
            document.getElementById('app-container').innerHTML = html;
            lucide.createIcons();
        }

        window.renderAdminLogin = () => {
            document.getElementById('app-container').innerHTML = `
                <div class="min-h-[80vh] flex items-center justify-center p-4 text-center">
                    <div class="bg-slate-900 w-full max-w-md p-8 md:p-12 rounded-[2rem] md:rounded-[3rem] border border-slate-800 shadow-2xl">
                        <div class="mb-10">
                            <h2 class="text-slate-500 text-[10px] md:text-xs font-black uppercase tracking-[0.3em] mb-4">Master Console</h2>
                            <h2 class="text-2xl md:text-3xl font-black text-white mb-2 uppercase tracking-tighter">Admin Access</h2>
                            <p class="text-emerald-400 font-hindi tracking-widest text-[9px] md:text-[10px] font-bold">Professor Amit Raval</p>
                        </div>
                        <div class="space-y-4 md:space-y-5 text-left">
                            <input id="adm-id" type="text" placeholder="Identity Identifier" class="w-full bg-slate-800 border border-slate-700 rounded-xl md:rounded-2xl p-4 md:p-5 text-white outline-none focus:ring-2 focus:ring-emerald-500 text-sm md:text-base">
                            <input id="adm-pass" type="password" placeholder="System Passkey" class="w-full bg-slate-800 border border-slate-700 rounded-xl md:rounded-2xl p-4 md:p-5 text-white outline-none focus:ring-2 focus:ring-emerald-500 text-sm md:text-base">
                            <button onclick="handleAdminLogin()" class="w-full py-4 md:py-5 bg-emerald-500 text-white font-black rounded-xl md:rounded-2xl hover:bg-emerald-600 transition-all mt-6 shadow-xl text-[10px] md:text-xs uppercase tracking-[0.2em]">Authorize Access</button>
                        </div>
                    </div>
                </div>
            `;
        };

        window.handleAdminLogin = () => {
            if (document.getElementById('adm-id').value === 'amit_raval' && document.getElementById('adm-pass').value === 'robotics2025') {
                window.state.adminAuth = true;
                showView('admin-panel');
            } else showMessage("Authentication Denied", "Root access failed.", 'error');
        };

        window.renderAdminPanel = () => {
            let html = `
                <div class="p-4 md:p-12">
                    <div class="flex flex-wrap justify-between items-center mb-8 md:mb-16 gap-4">
                        <div><h1 class="text-2xl md:text-4xl font-black text-gradient uppercase italic tracking-tighter">Dashboard</h1><p class="text-slate-500 font-bold uppercase text-[9px] tracking-widest mt-1">BCA COLLEGE MODASA - System Admin</p></div>
                        <button onclick="window.state.adminAuth=false;showView('home')" class="px-6 md:px-8 py-2 md:py-3 bg-red-500/10 text-red-500 rounded-xl md:rounded-2xl flex items-center gap-2 hover:bg-red-500 transition-all font-black text-[10px] md:text-xs uppercase tracking-widest"><i data-lucide="log-out" class="w-4 h-4"></i> Logout</button>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-12">
                        <div class="bg-slate-900 p-6 md:p-10 rounded-2xl md:rounded-[3rem] border border-slate-800 shadow-xl h-fit text-white">
                            <h3 class="font-black mb-8 flex items-center gap-3 font-sans text-[10px] md:text-xs uppercase tracking-widest text-white border-b border-slate-800 pb-4"><i data-lucide="settings" class="text-emerald-400"></i> Terminal Control</h3>
                            <div class="space-y-8">
                                <div>
                                    <label class="text-[9px] md:text-[10px] text-slate-500 block mb-4 uppercase tracking-[0.2em] font-black">Portal Logo Identifier</label>
                                    <div class="flex gap-2 md:gap-4">
                                        ${['üêç', 'üíª', 'ü§ñ', 'üöÄ'].map(l => `<button onclick="updateLogo('${l}')" class="p-3 md:p-5 bg-slate-800 rounded-xl md:rounded-2xl border-2 transition-all ${window.state.examControl.logo === l ? 'border-emerald-400 bg-emerald-500/5' : 'border-slate-700 hover:border-slate-500'} text-xl md:text-2xl shadow-inner">${l}</button>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-2 bg-slate-900 p-6 md:p-10 rounded-2xl md:rounded-[3rem] border border-slate-800 shadow-xl text-white">
                            <h3 class="font-black mb-8 flex items-center gap-3 text-amber-500 font-sans text-[10px] md:text-xs uppercase tracking-widest border-b border-slate-800 pb-4"><i data-lucide="alert-circle"></i> Auth Requests</h3>
                            <div class="space-y-4">
                                ${window.state.requests.filter(r => r.status === 'pending').map(r => `
                                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center p-5 md:p-8 bg-slate-800/40 rounded-2xl border border-slate-700 gap-4 transition-all hover:bg-slate-800/60 shadow-inner">
                                        <div>
                                            <p class="font-black text-lg md:text-xl text-white tracking-tight">${r.name}</p>
                                            <p class="text-[10px] text-slate-500 uppercase font-bold mt-1 font-mono tracking-widest">BCA_MODASA_ID: ${r.roll}</p>
                                        </div>
                                        <button onclick="approveRequest('${r.id}')" class="w-full sm:w-auto px-10 py-4 bg-emerald-500 text-white font-black rounded-xl text-[10px] md:text-xs uppercase tracking-widest transition-all shadow-lg active:scale-95 shadow-emerald-500/20">Authorize</button>
                                    </div>
                                `).join('')}
                                ${window.state.requests.filter(r => r.status === 'pending').length === 0 ? '<div class="text-center py-10 md:py-20 opacity-30 italic text-sm tracking-widest uppercase font-black">All Authorization Tokens Clear. System Stable.</div>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('app-container').innerHTML = html;
            lucide.createIcons();
        };

        window.updateLogo = (l) => {
            window.state.examControl.logo = l;
            document.getElementById('nav-logo').innerText = l;
            renderAdminPanel();
        };

        window.approveRequest = async (id) => {
            if (!window.state.user) return;
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'requests', id), { status: 'approved' });
            showMessage("Access Authorized", "Terminal access granted.", 'info');
        };

        init();
    </script>
</body>
</html>
